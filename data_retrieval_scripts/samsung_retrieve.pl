#!/usr/bin/perl

use DBI;
use Time::Local;

$age = DBI->connect('DBI:mysql:agentinfo;host=localhost','root','');
$ag="1460106541,1956378294,2130872262,2133358244,1461375735,1459267951,2060039010,2130921131,1732258436,1468242109,2135002231,2136125772,2139838598,1926979299,2109386717,2097503866,1457966526,1923863086,2143402310,2015366771,2004990007,2137007065,2143516442,1467675339,2013281126,1930249962,2130871852,2137339553,1469464191,1478450651,2143262003,2138439191,2143036041,1469495674,2137167889,2140907184,2142872590,1457851082,2135324173,2143127568,2131678496,1457969738,2131652080,1469414793,1773149691,2137266817,2141705717,2142889426,2132605814,2031571516,2126685107,2135994165,2038606100,2143964449,2124324460,2133164326,1918912825,2146746415,2132226324,2137989769,2006878748,1886000844,2135742153,2010595501,2144220949,2144082632,2042833435,2027018284,2049868879,2131890903,2139446998,2138241220,2137544371,1451214091,2131253130,1467280664,1913638588,1468360565,2142971942,300407345,2144287159,2142120283,1466403955,2145414683,1392111350,2138421026,2146277430,2143173216,1484794401,2141734824,2144820774,2087880278,2145815999,2138104645,2144307016,1477587923,1393576525,2135883586,2143119491,1467967155,2142934861,1608171588,2115892679,2143075876,2140004024,589407255,1467424072,2146895089,2103071606,1470622381,1474230519,2144755654,2130764842,567257735,1476504716,2146403771,2143285476,1901712077,1392524872,476710894,2098080066,1466359716,2144950626,2141579339,1468061232,1476957101,1467939376,1460160267,1470363181,1561260937,1466372527,2138875024,1466082269,1466086760,1474528268,1469523495,2144973570,1466108877,2146344119,2132426947,2067366150,2142873646,637772510,1561237465,2143819512,2145326944,1500183113,2144978327,1483999475,2143955152,2143803194,1466102699,1474233553,2144993520,2146319980,1468293998,2135281224,2145810847,1392467583,593144551,2144074131,2145765311,2144388507,2143161308,2146529753,2137387140,1617687370,2145575522,2146540754,1474580293,2143147625,2143094249,2143302354,1553720120,821458381,1392306077,306025836,2145695287,2004849662,1492012600,1952606812,1476653639,2143263519,1494402178,2145725113,2146034945,2146893437,598225814,1594648282,1460999641,1856213337,1474686431,1474686235,2009257644,2146713741,2009395899,2046398224,1470326377,1490606477,1501274401,1538104911,2144623053,1961176912,2105422295,2144358046,1461831183,2112491321,306025872,1520048949,1479541081,310576807,1502176166,1529524514,819378639,1692555045,2146341187,589144469,2147424579,1471389748,1478242793,1479179780,1482777618,1519771623,2135261542,2053052049,1478244951,1470396805,1517758076,1500692647,1536822955,1562068726,1570464342,1728141278,2035278330,1466169760,1467946793,206064357,2142146225,1552936888,2146409506,2130985931,2096107797,1471578470,2146221143,2111481322,308517180,1526056652,1527472979,2143437949,1737142901,2147061984,2009727434,1894721130,2022338076,253803,1570065115,2145328883,87878,311330851,2144816676,2104248418,1470615986,1500807213,1641927983,2145339686,1956816189,1914478900,1490770239,1519169913,1534478866,1567656410,2143641467,2144034739,1599367333,2143848462,2092415152,2006811857,1518405184,2143898960,2145791233,153681,2039650587,1501193093,1516018441,1537097800,2143283291,2130896547,1484286827,1495090844,1516247952,1519509136,2143891374,1599505335,2145301532,2145480602,2145801957,1754097420,1827374429,2006330183,2049640844,1467043795,1483883567,2143182829,1626976177,1629770233,2144786811,2145888202,1731817800,2147199800,490712050,1470031869,1595914217,1789468067,1479831039,304799230,1495212743,1517764360,1540839236,1692864253,1779246201,1463091882,1474536572,1476501258,1482564075,1498741826,1484072597,819601127,1676378250,1668665684,2146725982,1887979789,48216,1393721862,309614,1466082002,1475948057,2138797817,1484354960,1518299519,1515853459,1557831174,2143649697,1580142499,1609765222,2144721296,2144792020,2145407678,1706193011,1737179980,1781898758,1057952744,1790833979";
my $agents = $age->prepare("select a_id,a_name,a_start,a_last,a_valuedays,a_realvaluedays,a_last_5p from agent where a_id in ($ag)");
my $count = $age->prepare("select ag_count,ag_nodata from agentgraph where ag_a_id=? and ag_day<? order by ag_id");

{
   $agents->execute();
   while (my $sresult = $agents->fetchrow_hashref())
   {
      my $aid=$sresult->{a_id};
      my $aname=$sresult->{a_name};
      my $astart=$sresult->{a_start};
      my $alast=$sresult->{a_last};
      my $alast5p=$sresult->{a_last_5p};
      my $avaluedays=$sresult->{a_valuedays};
      my $a_realvaluedays=$sresult->{a_realvaluedays};


      $count->execute($aid,$alast5p);
      $mynum=0;

      undef @xvalues;
      undef @yvalues;
      my $prevd=0;

      open F,">datapoints_samsung/".$aid.".csv";
      while (my $rcount = $count->fetchrow_hashref())
      {
         my $agcount = $rcount->{ag_count};
         my $nodata = $rcount->{ag_nodata};

         if ($nodata == 1)
         {
            $agcount=$prevd;
         }
         else
         {
            $prevd=$agcount;
         }
         $mynum++;
         print F $mynum.",".$agcount."\n";
      }
      $mynum++;
      for ($j=$mynum;$j<365*2;$j++)
      {
        print F $j.",0\n";
      }
      close(F);
      
   }
}


